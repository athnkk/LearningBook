# 6.2FFmpeg.md
- [FFmpeg安装](#6.1)
- [FFmpeg命令行](#6.2)
- [FFmpeg函数](#6.3)
- [FFmpeg使用注意点](#6.4)



## <a id="6.1">FFmpeg安装</a>
### 一般安装
```shell
./configure  --prefix=$PROJECT_DIR/3rdpart/ffmpeg/build \
            --prefix=/usr/local/ffmpeg 
            --enable-shared          \
            --enable-static          \
            --disable-doc
make -j4&& make install  
export PATH=$PROJECT_DIR/3rdpart/ffmpeg-4.2.2/build/bin:$PATH
export LD_LIBRARY_PATH=/home/lj/gy/MediaPlat/3rdpart/ffmpeg-4.2.2/build/lib

如果没有make install到usr/local目录下需要配置lib bin
/etc/profile  export PATH=/usr/local/ffmpeg/bin:$PATH    配置bin路径
/etc/ld.so.conf  /usr/local/ffmpeg/lib  ldconfig         配置lib路径
```

### 编译FFMpeg集成H264 H265
```shell
下载资源：
1.前往FFmpeg官方网站下载自己需要版本的FFMpeg:
https://ffmpeg.org/download.html

2.x264官方下载页:
https://www.videolan.org/developers/x264.html

3.如果下载最新版本，可以直接从如下地址获取:
ftp://ftp.videolan.org/pub/x264/snapshots/last_x264.tar.bz2

4.x265官方下载页:
https://bitbucket.org/multicoreware/x265/downloads/
```

#### 编译x264
./configure  --disable-asm --enable-shared
make -j4  
make install  

#### 编译x265
cd x265_3.1.1/source/  
cmake CMakeLists.txt  
make -j4  
make install  

#### ffmpeg编译选项
基本参数选项：  
<table><tbody><tr><td valign="top">
<p><strong><span style="color:rgb(49,132,155);">命令</span></strong></p>
</td>
<td valign="top">
<p><strong><span style="color:rgb(49,132,155);">帮助信息</span></strong></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--help</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>显示此帮助信息<span style="font-family:Calibri;">|print this message</span></p>
</td>
</tr><tr><td valign="top">
<p>--log[=FILE|yes|no]</p>
</td>
<td valign="top">
<p>记录测试并输出到<span style="font-family:Calibri;">config.err</span><span style="font-family:'宋体';">文件</span><span style="font-family:Calibri;">|log tests and output to FILE [config.err]</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--prefix=PREFIX</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>安装程序到指定目录（默认<span style="font-family:Calibri;">/usr/local</span><span style="font-family:'宋体';">）</span><span style="font-family:Calibri;">|install in PREFIX [/usr/local]</span></p>
</td>
</tr><tr><td valign="top">
<p>--libdir=DIR</p>
</td>
<td valign="top">
<p>安装库到指定目录（默认<span style="font-family:Calibri;">prefix/lib</span><span style="font-family:'宋体';">）</span><span style="font-family:Calibri;">|install libs in DIR [PREFIX/lib]</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--shlibdir=DIR</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>指定共享库路径（默认<span style="font-family:Calibri;">prefix/lib</span><span style="font-family:'宋体';">）</span><span style="font-family:Calibri;">|install shared libs in DIR [PREFIX/lib]</span></p>
</td>
</tr><tr><td valign="top">
<p>--incdir=DIR</p>
</td>
<td valign="top">
<p>指定<span style="font-family:Calibri;">includes</span><span style="font-family:'宋体';">路径（默认</span><span style="font-family:Calibri;">prefix/include/ffmpeg</span><span style="font-family:'宋体';">）</span><span style="font-family:Calibri;">|install includes in DIR[PREFIX/include/ffmpeg]</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--mandir=DIR</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>指定<span style="font-family:Calibri;">man page</span><span style="font-family:'宋体';">路径（默认</span><span style="font-family:Calibri;">prefix/man</span><span style="font-family:'宋体';">）</span><span style="font-family:Calibri;">install man page in DIR [PREFIX/man]</span></p>
</td>
</tr><tr><td valign="top">
<p>--enable-mp3lame</p>
</td>
<td valign="top">
<p>启用<span style="font-family:Calibri;">mp3</span><span style="font-family:'宋体';">编码</span><span style="font-family:Calibri;">libmp3lame</span><span style="font-family:'宋体';">（默认关闭）</span><span style="font-family:Calibri;">enable MP3 encoding via libmp3lame[default=no]</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--enable-libogg</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>启用<span style="font-family:Calibri;">ogg</span><span style="font-family:'宋体';">支持</span><span style="font-family:Calibri;">libogg</span><span style="font-family:'宋体';">（默认关闭）</span><span style="font-family:Calibri;">enable Ogg support via libogg [default=no]</span></p>
</td>
</tr><tr><td valign="top">
<p>--enable-vorbis</p>
</td>
<td valign="top">
<p>启用<span style="font-family:Calibri;">Vorbis</span><span style="font-family:'宋体';">支持</span><span style="font-family:Calibri;">libvorbis</span><span style="font-family:'宋体';">（默认关闭）</span><span style="font-family:Calibri;">enable Vorbis support via libvorbis [default=no]</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--enable-faad</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>启用<span style="font-family:Calibri;">faad</span><span style="font-family:'宋体';">支持</span><span style="font-family:Calibri;">libfaad</span><span style="font-family:'宋体';">（默认关闭）</span><span style="font-family:Calibri;">enable FAAD support via libfaad [default=no]</span></p>
</td>
</tr><tr><td valign="top">
<p>--enable-faadbin</p>
</td>
<td valign="top">
<p>启用<span style="font-family:Calibri;">faad</span><span style="font-family:'宋体';">运行时链接支持（默认关闭）</span><span style="font-family:Calibri;">build FAAD support with runtime linking[default=no]</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--enable-faac</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>启用<span style="font-family:Calibri;">faac</span><span style="font-family:'宋体';">支持</span><span style="font-family:Calibri;">libfaac</span><span style="font-family:'宋体';">（默认关闭）</span><span style="font-family:Calibri;">enable FAAC support via libfaac [default=no]</span></p>
</td>
</tr><tr><td valign="top">
<p>--enable-libgsm</p>
</td>
<td valign="top">
<p>启用<span style="font-family:Calibri;">GSM</span><span style="font-family:'宋体';">支持</span><span style="font-family:Calibri;">libgsm</span><span style="font-family:'宋体';">（默认关闭）</span><span style="font-family:Calibri;">enable GSM support via libgsm [default=no]</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--enable-xvid</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>启用<span style="font-family:Calibri;">xvid</span><span style="font-family:'宋体';">支持</span><span style="font-family:Calibri;">xvidcore</span><span style="font-family:'宋体';">（默认关闭）</span><span style="font-family:Calibri;">enable XviD support via xvidcore [default=no]</span></p>
</td>
</tr><tr><td valign="top">
<p><span style="color:rgb(255,0,0);">--enable-</span><span style="color:rgb(255,0,0);">lib</span><span style="color:rgb(255,0,0);">x264</span></p>
</td>
<td valign="top">
<p><span style="color:rgb(255,0,0);">启用<span style="font-family:Calibri;">H.264</span><span style="font-family:'宋体';">编码（默认关闭）</span><span style="font-family:Calibri;">enable H.264 encoding via x264 [default=no]</span></span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--enable-mingw32</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>启用<span style="font-family:Calibri;">MinGW</span><span style="font-family:'宋体';">本地</span><span style="font-family:Calibri;">/</span><span style="font-family:'宋体';">交叉</span><span style="font-family:Calibri;">win</span><span style="font-family:'宋体';">环境编译</span><span style="font-family:Calibri;">|enable
 MinGW native/cross Windows compile</span></p>
</td>
</tr><tr><td valign="top">
<p>--enable-mingwce</p>
</td>
<td valign="top">
<p>启用<span style="font-family:Calibri;">MinGW</span><span style="font-family:'宋体';">本地</span><span style="font-family:Calibri;">/</span><span style="font-family:'宋体';">交叉</span><span style="font-family:Calibri;">winCE</span><span style="font-family:'宋体';">环境编译</span><span style="font-family:Calibri;">enable
 MinGW native/cross WinCE compile</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--enable-a52</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>启用<span style="font-family:Calibri;">A52</span><span style="font-family:'宋体';">支持（默认关闭）</span><span style="font-family:Calibri;">enable GPLed A52 support [default=no]</span></p>
</td>
</tr><tr><td valign="top">
<p>--enable-a52bin</p>
</td>
<td valign="top">
<p>启用运行时打开<span style="font-family:Calibri;">liba52.so.0</span><span style="font-family:'宋体';">（默认关闭）</span><span style="font-family:Calibri;">open liba52.so.0 at runtime [default=no]</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--enable-dts</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>启用<span style="font-family:Calibri;">DTS</span><span style="font-family:'宋体';">支持（默认关闭）</span><span style="font-family:Calibri;">enable GPLed DTS support [default=no]</span></p>
</td>
</tr><tr><td valign="top">
<p>--enable-pp</p>
</td>
<td valign="top">
<p>启用后加工支持（默认关闭）<span style="font-family:Calibri;">enable GPLed postprocessing support [default=no]</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--enable-static</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>构建静态库（默认启用）<span style="font-family:Calibri;">build static libraries [default=yes]</span></p>
</td>
</tr><tr><td valign="top">
<p><span style="color:rgb(255,0,0);">--disable-static</span></p>
</td>
<td valign="top">
<p><span style="color:rgb(255,0,0);">禁止构建静态库（默认关闭）<span style="font-family:Calibri;">do not build static libraries [default=no]</span></span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p><span style="color:rgb(255,0,0);">--enable-shared</span></p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p><span style="color:rgb(255,0,0);">构建共享库（默认关闭）<span style="font-family:Calibri;">build shared libraries [default=no]</span></span></p>
</td>
</tr><tr><td valign="top">
<p>--disable-shared</p>
</td>
<td valign="top">
<p>禁止构建共享库（默认启用）<span style="font-family:Calibri;">do not build shared libraries [default=yes]</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--enable-amr_nb</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>启用<span style="font-family:Calibri;">amr_nb float</span><span style="font-family:'宋体';">音频编解码器</span><span style="font-family:Calibri;">|enable amr_nb float audio codec</span></p>
</td>
</tr><tr><td valign="top">
<p>--enable-amr_nb-fixed</p>
</td>
<td valign="top">
<p>启用<span style="font-family:Calibri;">fixed amr_nb codec | use fixed point for amr-nb codec</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--enable-amr_wb</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>启用<span style="font-family:Calibri;">amr_wb float</span><span style="font-family:'宋体';">音频编解码器</span><span style="font-family:Calibri;">|enable amr_wb float audio codec</span></p>
</td>
</tr><tr><td valign="top">
<p>--enable-amr_if2</p>
</td>
<td valign="top">
<p>启用<span style="font-family:Calibri;">amr_wb IF2</span><span style="font-family:'宋体';">音频编解码器</span><span style="font-family:Calibri;">|enable amr_wb IF2 audio codec</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--enable-sunmlib</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>启用<span style="font-family:Calibri;">Sun medialib</span><span style="font-family:'宋体';">（默认关闭）</span><span style="font-family:Calibri;">| use Sun medialib [default=no]</span></p>
</td>
</tr><tr><td valign="top">
<p><span style="color:rgb(255,0,0);">--enable-pthreads</span></p>
</td>
<td valign="top">
<p><span style="color:rgb(255,0,0);">启用<span style="font-family:Calibri;">pthreads</span><span style="font-family:'宋体';">（多线程）（默认关闭）</span><span style="font-family:Calibri;">use pthreads [default=no]</span></span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--enable-dc1394</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>启用<span style="font-family:Calibri;">libdc1394</span><span style="font-family:'宋体';">、</span><span style="font-family:Calibri;">libraw1394</span><span style="font-family:'宋体';">抓取</span><span style="font-family:Calibri;">IIDC-1394</span><span style="font-family:'宋体';">（默认关闭）</span><span style="font-family:Calibri;">enable
 IIDC-1394 grabbing using libdc1394 and libraw1394 [default=no]</span></p>
</td>
</tr><tr><td valign="top">
<p>--enable-swscaler</p>
</td>
<td valign="top">
<p>启用计数器支持？（默认关闭）<span style="font-family:Calibri;">software scaler support [default=no]</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--enable-avisynth</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>允许读取<span style="font-family:Calibri;">AVISynth</span><span style="font-family:'宋体';">脚本本件（默认关闭）</span><span style="font-family:Calibri;">allow reading AVISynth script files [default=no]</span></p>
</td>
</tr><tr><td valign="top">
<p>--enable-gpl</p>
</td>
<td valign="top">
<p>允许使用<span style="font-family:Calibri;">GPL</span><span style="font-family:'宋体';">（默认关闭）</span><span style="font-family:Calibri;">allow use of GPL code, the resulting libav* and ffmpeg will be under GPL [default=no]</span></p>
</td>
</tr></tbody></table>

高级参数选项：  
<table><tbody><tr><td valign="top">
<p><strong><span style="color:rgb(49,132,155);">命令</span></strong></p>
</td>
<td valign="top">
<p><strong><span style="color:rgb(49,132,155);">帮助信息</span></strong></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--source-path=PATH</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>源码的路径（当前为<span style="font-family:Calibri;">/root/flv/ffmpeg</span><span style="font-family:'宋体';">）</span><span style="font-family:Calibri;">| path to source code [/root/flv/ffmpeg]</span></p>
</td>
</tr><tr><td valign="top">
<p>--cross-prefix=PREFIX</p>
</td>
<td valign="top">
<p>为编译工具指定路径 <span style="font-family:Calibri;">| use PREFIX for compilation tools []</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--cross-compile</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>假定使用了交叉编译 <span style="font-family:Calibri;">| assume a cross-compiler is used</span></p>
</td>
</tr><tr><td valign="top">
<p>--cc=CC</p>
</td>
<td valign="top">
<p>指定使用何种<span style="font-family:Calibri;">C</span><span style="font-family:'宋体';">编译器（默认</span><span style="font-family:Calibri;">gcc</span><span style="font-family:'宋体';">）</span><span style="font-family:Calibri;">use C compiler CC [gcc]</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--make=MAKE</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>使用特定的<span style="font-family:Calibri;">make | use specified make [make]</span></p>
</td>
</tr><tr><td valign="top">
<p>--extra-cflags=ECFLAGS</p>
</td>
<td valign="top">
<p>添加<span style="font-family:Calibri;">ECFLAGS</span><span style="font-family:'宋体';">到</span><span style="font-family:Calibri;">CFLAGS | add ECFLAGS to CFLAGS []</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--extra-ldflags=ELDFLAGS</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>添加<span style="font-family:Calibri;">ELDFLAGS</span><span style="font-family:'宋体';">到</span><span style="font-family:Calibri;">LDFLAGS</span><span style="font-family:'宋体';">（默认</span><span style="font-family:Calibri;">-Wl</span><span style="font-family:'宋体';">，</span><span style="font-family:Calibri;">--as-needed</span><span style="font-family:'宋体';">）</span><span style="font-family:Calibri;">|
 add ELDFLAGS to LDFLAGS [ -Wl,--as-needed]</span></p>
</td>
</tr><tr><td valign="top">
<p>--extra-libs=ELIBS</p>
</td>
<td valign="top">
<p>添加<span style="font-family:Calibri;">ELIBS | add ELIBS []</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--build-suffix=SUFFIX</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>为专用程序添加后缀 <span style="font-family:Calibri;">| suffix for application specific build []</span></p>
</td>
</tr><tr><td valign="top">
<p>--arch=ARCH</p>
</td>
<td valign="top">
<p>选择机器架构（默认<span style="font-family:Calibri;">x86</span><span style="font-family:'宋体';">）</span><span style="font-family:Calibri;">select architecture [x86]</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--cpu=CPU</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>选用最低的<span style="font-family:Calibri;">cpu</span><span style="font-family:'宋体';">（影响指令的选择，可以在老</span><span style="font-family:Calibri;">CPU</span><span style="font-family:'宋体';">上出错）</span><span style="font-family:Calibri;">| selects the minimum cpu required (affects
 instruction selection, may crash on older CPUs)</span></p>
</td>
</tr><tr><td valign="top">
<p>--powerpc-perf-enable</p>
</td>
<td valign="top">
<p>启用<span style="font-family:Calibri;">PPC</span><span style="font-family:'宋体';">上面的性能报告（需要启用</span><span style="font-family:Calibri;">PMC</span><span style="font-family:'宋体';">）</span><span style="font-family:Calibri;">enable performance report on PPC</span>(requires
 enabling PMC)</p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--disable-mmx</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>禁用<span style="font-family:Calibri;">MMX | disable MMX usage</span></p>
</td>
</tr><tr><td valign="top">
<p>--disable-armv5te</p>
</td>
<td valign="top">
<p>禁用<span style="font-family:Calibri;">armv5te | disable armv5te usage</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--disable-iwmmxt</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>禁用<span style="font-family:Calibri;">iwmmxt | disable iwmmxt usage</span></p>
</td>
</tr><tr><td valign="top">
<p>--disable-altivec</p>
</td>
<td valign="top">
<p>禁用<span style="font-family:Calibri;">AltiVec | disable AltiVec usage</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--disable-audio-oss</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>禁用<span style="font-family:Calibri;">OSS</span><span style="font-family:'宋体';">音频支持（默认启用）</span><span style="font-family:Calibri;">disable OSS audio support [default=no]</span></p>
</td>
</tr><tr><td valign="top">
<p>--disable-audio-beos</p>
</td>
<td valign="top">
<p>禁用<span style="font-family:Calibri;">BeOS</span><span style="font-family:'宋体';">音频支持（默认启用）</span><span style="font-family:Calibri;">disable BeOS audio support [default=no]</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--disable-v4l</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>禁用<span style="font-family:Calibri;">video4linux</span><span style="font-family:'宋体';">提取（默认启用）</span><span style="font-family:Calibri;">disable video4linux grabbing [default=no]</span></p>
</td>
</tr><tr><td valign="top">
<p>--disable-v4l2</p>
</td>
<td valign="top">
<p>禁用<span style="font-family:Calibri;">video4linux2</span><span style="font-family:'宋体';">提取（默认启用）</span><span style="font-family:Calibri;">disable video4linux2 grabbing [default=no]</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--disable-bktr</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>禁用<span style="font-family:Calibri;">bktr</span><span style="font-family:'宋体';">视频提取（默认启用）</span><span style="font-family:Calibri;">disable bktr video grabbing [default=no]</span></p>
</td>
</tr><tr><td valign="top">
<p>--disable-dv1394</p>
</td>
<td valign="top">
<p>禁用<span style="font-family:Calibri;">DV1394</span><span style="font-family:'宋体';">提取（默认启用）</span><span style="font-family:Calibri;">disable DV1394 grabbing [default=no]</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--disable-network</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>禁用网络支持（默认支持）<span style="font-family:Calibri;">disable network support [default=no]</span></p>
</td>
</tr><tr><td valign="top">
<p>--disable-ipv6</p>
</td>
<td valign="top">
<p>禁用<span style="font-family:Calibri;">ipv6</span><span style="font-family:'宋体';">支持（默认支持）</span><span style="font-family:Calibri;">disable ipv6 support [default=no]</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--disable-zlib</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>禁用<span style="font-family:Calibri;">zlib</span><span style="font-family:'宋体';">（默认支持）</span><span style="font-family:Calibri;">disable zlib [default=no]</span></p>
</td>
</tr><tr><td valign="top">
<p>--disable-simple_idct</p>
</td>
<td valign="top">
<p>禁用<span style="font-family:Calibri;">simple IDCT</span><span style="font-family:'宋体';">例程（默认启用）</span><span style="font-family:Calibri;">disable simple IDCT routines [default=no]</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--disable-vhook</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>禁用<span style="font-family:Calibri;">video hooking</span><span style="font-family:'宋体';">支持</span><span style="font-family:Calibri;">| disable video hooking support</span></p>
</td>
</tr><tr><td valign="top">
<p>--enable-gprof</p>
</td>
<td valign="top">
<p>启用profiling with gprof [no]</p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--disable-debug</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>禁用调试符号 <span style="font-family:Calibri;">| disable debugging symbols</span></p>
</td>
</tr><tr><td valign="top">
<p>--disable-opts</p>
</td>
<td valign="top">
<p>禁用编译器最优化 <span style="font-family:Calibri;">| disable compiler optimizations</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--disable-mpegaudio-hp</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>启用更快的解码<span style="font-family:Calibri;">MPEG</span><span style="font-family:'宋体';">音频（但精确度较低）（默认禁用）</span><span style="font-family:Calibri;">faster (but less accurate) MPEG audio decoding [default=no]</span></p>
</td>
</tr><tr><td valign="top">
<p>--disable-protocols</p>
</td>
<td valign="top">
<p>禁用 <span style="font-family:Calibri;">I/O </span><span style="font-family:'宋体';">协议支持（默认启用）</span><span style="font-family:Calibri;">disable I/O protocols support [default=no]</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--disable-ffserver</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>禁用生成<span style="font-family:Calibri;">ffserver | disable ffserver build</span></p>
</td>
</tr><tr><td valign="top">
<p>--disable-ffplay</p>
</td>
<td valign="top">
<p>禁用生成<span style="font-family:Calibri;">ffplay | disable ffplay build</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--enable-small</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>启用优化文件尺寸大小（牺牲速度）<span style="font-family:Calibri;">optimize for size instead of speed</span></p>
</td>
</tr><tr><td valign="top">
<p><span style="color:rgb(255,0,0);">--enable-memalign-hack</span></p>
</td>
<td valign="top">
<p><span style="color:rgb(255,0,0);">启用模拟内存排列，由内存调试器干涉？ <span style="font-family:Calibri;">
| emulate memalign, interferes with memory debuggers</span></span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--disable-strip</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>禁用剥离可执行程序和共享库 <span style="font-family:Calibri;">| disable stripping of executables and shared libraries</span></p>
</td>
</tr><tr><td valign="top">
<p>--disable-encoder=NAME</p>
</td>
<td valign="top">
<p>禁用<span style="font-family:Calibri;">XX</span><span style="font-family:'宋体';">编码器 </span>
<span style="font-family:Calibri;">| disables encoder NAME</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--enable-encoder=NAME</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>启用<span style="font-family:Calibri;">XX</span><span style="font-family:'宋体';">编码器 </span>
<span style="font-family:Calibri;">| enables encoder NAME</span></p>
</td>
</tr><tr><td valign="top">
<p>--disable-decoder=NAME</p>
</td>
<td valign="top">
<p>禁用<span style="font-family:Calibri;">XX</span><span style="font-family:'宋体';">解码器 </span>
<span style="font-family:Calibri;">| disables decoder NAME</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--enable-decoder=NAME</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>启用<span style="font-family:Calibri;">XX</span><span style="font-family:'宋体';">解码器 </span>
<span style="font-family:Calibri;">| enables decoder NAME</span></p>
</td>
</tr><tr><td valign="top">
<p>--disable-encoders</p>
</td>
<td valign="top">
<p>禁用所有编码器 <span style="font-family:Calibri;">| disables all encoders</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--disable-decoders</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>禁用所有解码器 <span style="font-family:Calibri;">| disables all decoders</span></p>
</td>
</tr><tr><td valign="top">
<p>--disable-muxer=NAME</p>
</td>
<td valign="top">
<p>禁用<span style="font-family:Calibri;">XX</span><span style="font-family:'宋体';">混音器 </span>
<span style="font-family:Calibri;">| disables muxer NAME</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--enable-muxer=NAME</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>启用<span style="font-family:Calibri;">XX</span><span style="font-family:'宋体';">混音器 </span>
<span style="font-family:Calibri;">| enables muxer NAME</span></p>
</td>
</tr><tr><td valign="top">
<p>--disable-muxers</p>
</td>
<td valign="top">
<p>禁用所有混音器 <span style="font-family:Calibri;">| disables all muxers</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--disable-demuxer=NAME</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>禁用<span style="font-family:Calibri;">XX</span><span style="font-family:'宋体';">解轨器 </span>
<span style="font-family:Calibri;">| disables demuxer NAME</span></p>
</td>
</tr><tr><td valign="top">
<p>--enable-demuxer=NAME</p>
</td>
<td valign="top">
<p>启用<span style="font-family:Calibri;">XX</span><span style="font-family:'宋体';">解轨器 </span>
<span style="font-family:Calibri;">| enables demuxer NAME</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--disable-demuxers</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>禁用所有解轨器 <span style="font-family:Calibri;">| disables all demuxers</span></p>
</td>
</tr><tr><td valign="top">
<p>--enable-parser=NAME</p>
</td>
<td valign="top">
<p>启用<span style="font-family:Calibri;">XX</span><span style="font-family:'宋体';">剖析器 </span>
<span style="font-family:Calibri;">| enables parser NAME</span></p>
</td>
</tr><tr><td valign="top" style="background:rgb(210,234,240);">
<p>--disable-parser=NAME</p>
</td>
<td valign="top" style="background:rgb(210,234,240);">
<p>禁用<span style="font-family:Calibri;">XX</span><span style="font-family:'宋体';">剖析器 </span>
<span style="font-family:Calibri;">| disables parser NAME</span></p>
</td>
</tr><tr><td valign="top">
<p>--disable-parsers</p>
</td>
<td valign="top">
<p>禁用所有剖析器 <span style="font-family:Calibri;">| disables all parsers</span></p>
</td>
</tr></tbody></table>


## <a id="6.2">FFmpeg命令行</a>
- [文件封装格式转换](#6.2.1)  
- [拉流存储](#6.2.2)
- [推流](#6.2.3)  

参考链接：  
* ffmpeg 常用命令总结  
https://blog.csdn.net/weixin_42081389/article/details/100543007  


FFmpeg命令行说明  
命令行基本格式如下：  
ffmpeg [global_options] {[input_file_options] -i input_url} ... {[output_file_options] output_url} ...  

### <a id="6.2.1">文件封装格式转换</a>
#### 1)将mp4文件转换为flv文件
```js
ffmpeg  -i test.mp4  -c  copy  -f  flv  test.flv
-i 读取任意数量的输入文件(这些文件可以是正常文件、管道、网络流，抓取设备等)，写入任意数量的被声明为一个简单的输出文件名的文 件。在命令行的任何不能被解释的选项都被作为输出文件
-i test.mp4 输入文件是当前目录下的test.mp4文件
-c 编码方式，一般视频文件以h264编码、音频文件以aac编码居多
-c copy 拷贝输入文件的音视频编码方式到输出文件
-f flv 指定输出文件的封装方式为flv
```

#### 2)将flv文件转换为mp4文件
```js
ffmpeg  -i test.flv  -c  copy  -f  mp4  test.mp4
```

#### 3)将avi文件转换为mp4文件
```js
ffmpeg  -i test.avi  -c  copy  -f  mp4  test.mp4
```

#### 4)从mp4文件中提取h264
```js
ffmpeg -i test.mp4 -vcodec copy -an output.h264
-vcodec copy 拷贝原始视频的编码方式

ffmpeg -i test.mp4 -codec copy -bsf: h264_mp4toannexb -f h264 tmp.264  
-codec copy： 从mp4中拷贝  
-bsf: h264_mp4toannexb： 从mp4拷贝到annexB封装  
-an 取消音频
```

#### 5)将h264文件封装成mp4文件
```js
ffmpeg -i output.h264 -vcodec copy -f mp4 test.mp4
```

### <a id="6.2.2">拉流存储</a>
#### 1)按照时间间隔存储
```js
ffmpeg -rtsp_transport tcp -i rtsp://42.101.40.177:10236/stream1 -r 10 -f image2 /root/images%09d.png -c copy -map 0 -f segment -segment_time 60 -segment_format mp4 "/root/out%03d.mp4" -rtsp_transport tcp 用tcp方式读取rtsp视频流
-r 10  10帧/秒
-f image2 输出文件的格式image2
-map 0 所有输入流
-f segment 分段持续时间
-segment_format mp4 输出文件的格式为mp4
```

#### 2)标准拉流存储
```js
ffmpeg -rtmp_app live -i rtmp://192.168.1.23:1935/live1 -c copy -f mp4 out.mp4
-rtmp_app live 指定输入的rtmp地址为直播流的形式
```

### <a id="6.2.3">推流</a>
#### 1)推送rtsp流到rtsp服务器
ffmpeg -i rtsp://192.168.1.23:554/stream/ -c copy -f rtsp rtsp://192.168.1.24:554/stream/  

#### 2)推送视频文件到rtsp服务器
ffmpeg -re -i test.mp4 -vcodec copy -codec copy -f rtsp rtsp://192.168.1. 24:554/stream/  

#### 3)推送rtmp流到rtmp服务器
ffmpeg -re -i rtmp://192.168.1.23:1935/live1 -vcodec copy -codec copy -f flv rtmp://192.168.1.24:1935/live1  

#### 4)推送视频文件到rtmp服务器
ffmpeg -re -i test.mp4 -c copy -f flv rtmp://192.168.1.23:1935/live1  

#### 5)推送rtsp到rtmp服务器
ffmpeg -i rtsp://192.168.1.23:554/live1 -c copy -f flv rtmp://192.168.1.23:1935/live1  

####  6)推送rtmp流到rtsp服务器
ffmpeg -i rtmp://192.168.1.23:1935/live1-c copy -f rtsp rtsp://192.168.1.23:554/live1  



分离视频音频流
ffmpeg -i input_file -vcodec copy -an output_file_video　　//分离视频流
ffmpeg -i input_file -acodec copy -vn output_file_audio　　//分离音频流
2.视频解复用
ffmpeg –i test.mp4 –vcodec copy –an –f m4v test.264ffmpeg –i test.avi –vcodec copy –an –f m4v test.264
3.视频转码
ffmpeg –i test.mp4 –vcodec h264 –s 352*278 –an –f m4v test.264 //转码为码流原始文件
ffmpeg –i test.mp4 –vcodec h264 –bf 0 –g 25 –s 352*278 –an –f m4v test.264 //转码为码流原始文件
ffmpeg –i test.avi -vcodec mpeg4 –vtag xvid –qsame test_xvid.avi //转码为封装文件
-bf B帧数目控制
-g 关键帧间隔控制
-s 分辨率控制
4.视频封装
ffmpeg –i video_file –i audio_file –vcodec copy –acodec copy output_file
5.视频剪切
ffmpeg –i test.avi –r 1 –f image2 image-%3d.jpeg //提取图片
ffmpeg -ss 0:1:30 -t 0:0:20 -i input.avi -vcodec copy -acodec copy output.avi //剪切视频
-r 提取图像的频率
-ss 开始时间
-t 持续时间
6.视频录制
ffmpeg –i rtsp://192.168.3.205:5555/test –vcodec copy out.avi
7.YUV序列播放
ffplay -f rawvideo -video_size 1920x1080 input.yuv
8.YUV序列转AVI
ffmpeg –s w*h –pix_fmt yuv420p –i input.yuv –vcodec mpeg4 output.avi
9.常用参数说明：
主要参数：
i 设定输入流
f 设定输出格式
ss 开始时间
视频参数：
b 设定视频流量，默认为200Kbit/s-r 设定帧速率，默认为25
s 设定画面的宽与高-aspect 设定画面的比例
vn 不处理视频-vcodec 设定视频编解码器，未设定时则使用与输入流相同的编解码器
音频参数：
ar 设定采样率
ac 设定声音的Channel数
acodec 设定声音编解码器，未设定时则使用与输入流相同的编解码器an 不处理音频

作者：stlndm
链接：https://www.jianshu.com/p/d541b317f71c
来源：简书
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。



## <a id="6.3">FFmpeg函数</a>

## <a id="6.4">FFmpeg使用注意点</a>
### ffmpeg open函数打开rtsp地址失败
ffmpeg open函数打开rtsp地址失败，导致获取视频信息失败。可能是采用了rtsp tcp方式需要采用tcp方式。

## links
  * [目录](<音视频入门到精通目录.md>)