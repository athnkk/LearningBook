# 5.linux系统操作
- [防火墙设置](#1)
- [linux系统操作](#2)
- [linux系统net/port操作](#3)
- [Yum简介](#4)

## <a id="1">防火墙设置</a>
- [ubuntu防火墙](#1.1)
- [centos防火墙](#1.2)
- [开机启动](#1.3)

### <a id="1.1">ubuntu防火墙</a>
```shell
ufw status命令查看当前防火墙状态;inactive状态是防火墙关闭状态 active是开启状态。
ufw enable命令来开发防火墙
ufw disable命令来关闭防火墙
ufw default allow/deny:外来访问默认允许/拒绝
ufw allow/deny 20：允许/拒绝 访问20端口,20后可跟/tcp或/udp，表示tcp或udp封包。
ufw allow/deny servicename:ufw从/etc/services中找到对应service的端口，进行过滤。
ufw allow proto tcp from 10.0.1.0/10 to 本机ip port 25:允许自10.0.1.0/10的tcp封包访问本机的25端口。
ufw delete allow/deny 20:删除以前定义的"允许/拒绝访问20端口"的规则
```

### <a id="1.2">centos防火墙</a>
CentOS中防火墙程序主要是firewall和iptables，CentOS7中firewall服务已经默认安装好了，而iptables服务需要自己用yum  install  iptabes-services来安装。   
#### iptables
```shell
iptables-save：查看防火墙开放端口
yum install  iptables-services :iptables服务需要自己安装
systemctl  start  iptables.service:开启iptables防火墙
systemctl  restart  iptables.service:重启iptables防火墙的命令
systemctl  stop  iptables.service:关闭iptables防火墙
systemctl  status  iptables.service:查看iptables防火墙状态的命令
service  iptables status :iptables服务是否运行
iptables -L:列出iptables规则
iptables-F 清除列表规则
使用编辑文件的方式开放特定的端口,编辑/etc/sysconfig/iptables文件
iptables -A INPUT -p tcp -m tcp --dport  80 -j ACCEPT:放行80端口
iptables -A INPUT -p tcp --drop 端口号 -j DROP :关闭端口号
```

#### firewalld
```shell
firewall-cmd  --state:查看防火墙状态
systemctl stop firewalld.service:关闭防火墙
systemctl start firewalld.service:开启防火墙
systemctl disable firewalld.service:禁止开机启动启动防火墙
systemctl enable firewalld
firewall-cmd --zone=public --add-port=80/tcp --permanent:增加对外开放的端口
firewall-cmd --zone=public --add-port=5672/tcp --permanent   # 开放5672端口
firewall-cmd --zone=public --remove-port=5672/tcp --permanent  #关闭5672端口
firewall-cmd --query-port=23/tcp 查询23端口是否开放
firewall-cmd --reload:修改后需要重新加载重载防火墙
firewall-cmd --zone=public --list-ports
```

### <a id="1.3"> 开机启动</a>
```shell
service foo start       systemctl start foo.service	启动服务
service foo restart	    systemctl restart foo.service	重启服务
service foo stop	    systemctl stop foo.service	停止服务
service foo reload	    systemctl reload foo.service	重新加载配置文件（不终止服务）
service foo status	    systemctl status foo.service	查看服务状态
chkconfig foo on	    systemctl enable foo.service	开机自动启动
chkconfig foo off	    systemctl disable foo.service	开机不自动启动
chkconfig foo	        systemctl is-enabled foo.service	查看特定服务是否为开机自启动
chkconfig --list	    systemctl list-unit-files --type=service	查看各个级别下服务的启动与禁用情况
```

## <a id="2">linux系统操作</a>
### linux系统基础操作
```shell
dhclient:动态分配ip
tcpdum：转包命令行，可以保存位wireshark可解析文件
rpm -qa:检查是否安装
chkconfig：检查服务
chkconfig iptables off 停止开机项目
uname －a :（Linux查看版本当前操作系统内核信息）
cat /proc/version :（Linux查看当前操作系统版本信息）
cat /etc/issue  或cat /etc/redhat-release:（Linux查看版本当前操作系统发行版信息）
cat /proc/cpuinfo   lscpu :（Linux查看cpu相关信息，包括型号、主频、内核信息等）
getconf LONG_BIT:查看64/32
cat /etc/sysconfig/network-scripts/ifcfg-eth0   cat /etc/sysconfig/network-scripts/ifcfg-l0  ifconfig  （查看网络信息）
lsblk （查看磁盘信息 - 列出所有可用块设备的信息，而且还能显示他们之间的依赖关系，但是它不会列出RAM盘的信息）
fdisk -l   （观察硬盘实体使用情况，也可对硬盘分区）
df -k  （用于显示磁盘分区上的可使用的磁盘空间）
# head -n 1 /etc/issue # 查看操作系统版本 
# cat /proc/cpuinfo # 查看CPU信息 
# hostname # 查看计算机名 
# lspci -tv # 列出所有PCI设备 
# lsusb -tv # 列出所有USB设备 
# lsmod # 列出加载的内核模块 
# env # 查看环境变量资源 
# free -m # 查看内存使用量和交换区使用量 
# df -h # 查看各分区使用情况 
# du -sh <目录名> # 查看指定目录的大小 
# grep MemTotal /proc/meminfo # 查看内存总量 
# grep MemFree /proc/meminfo # 查看空闲内存量 
# uptime # 查看系统运行时间、用户数、负载 
# cat /proc/loadavg # 查看系统负载磁盘和分区 
# mount | column -t # 查看挂接的分区状态 
# fdisk -l # 查看所有分区 
# swapon -s # 查看所有交换分区 
# hdparm -i /dev/hda # 查看磁盘参数(仅适用于IDE设备) 
# dmesg | grep IDE # 查看启动时IDE设备检测状况网络 
# ifconfig # 查看所有网络接口的属性 
# iptables -L # 查看防火墙设置 
# route -n # 查看路由表 
# netstat -lntp # 查看所有监听端口 
# netstat -antp # 查看所有已经建立的连接 
# netstat -s # 查看网络统计信息进程 
# ps -ef # 查看所有进程 
# top # 实时显示进程状态用户 
# w # 查看活动用户 
# id <用户名> # 查看指定用户信息 
# last # 查看用户登录日志 
# cut -d: -f1 /etc/passwd # 查看系统所有用户 
# cut -d: -f1 /etc/group # 查看系统所有组 
# crontab -l # 查看当前用户的计划任务服务 
# chkconfig –list # 列出所有系统服务 
# chkconfig –list | grep on # 列出所有启动的系统服务程序 
cat /proc/uptime 查看文件计算系统启动时间：
第一数字即是系统已运行的时间5113396.94秒，运用系统工具date即可算出系统启动时间
date -d "$(awk -F. '{print $1}' /proc/uptime) second ago" +"%Y-%m-%d %H:%M:%S"
输出: 2018-01-02 06:50:52
查看/proc/uptime文件计算系统运行时间
cat /proc/uptime| awk -F. '{run_days=$1 / 86400;run_hour=($1 % 86400)/3600;run_minute=($1 % 3600)/60;run_second=$1 % 60;printf("系统已运行：%d天%d时%d分%d秒",run_days,run_hour,run_minute,run_second)}'
输出:系统已运行：1天1时36分13秒
```

### linux系统CPU
```shell
# 总核数 = 物理CPU个数 X 每颗物理CPU的核数 
# 总逻辑CPU数 = 物理CPU个数 X 每颗物理CPU的核数 X 超线程数
# 查看物理CPU个数
cat /proc/cpuinfo| grep "physical id"| sort| uniq| wc -l

# 查看每个物理CPU中core的个数(即核数)
cat /proc/cpuinfo| grep "cpu cores"| uniq
cpu cores       : 2
# 查看逻辑CPU的个数
cat /proc/cpuinfo| grep "processor"| wc -l
lscpu命令，查看的是cpu的统计信息
```

### linux系统caching
```shell
概要查看内存情况  free  -m    详细情况：cat /proc/meminfo
查看硬盘和分区分布： lsblk
如果要看硬盘和分区的详细信息：fdisk -l
使用“df -k”命令，以KB为单位显示磁盘使用量和占用率，-m则是以M为单位显示磁盘使用量和占用率
```

### linux系统/proc文件系统
Linux 内核提供了一种通过 /proc 文件系统，在运行时访问内核内部数据结构、改变内核设置的机制。proc文件系统是一个伪文件系统，它只存在内存当中，而不占用外存空间。它以文件系统的方式为访问系统内核数据的操作提供接口。  
用户和应用程序可以通过proc得到系统的信息，并可以改变内核的某些参数。由于系统的信息，如进程，是动态改变的，所以用户或应用程序读取proc文件时，proc文件系统是动态从系统内核读出所需信息并提交的。下面列出的这些文件或子文件夹，并不是都是在你的系统中存在，这取决于你的内核配置和装载的模块。另外，在/proc下还有三个很重要的目录：net，scsi和sys。 Sys目录是可写的，可以通过它来访问或修改内核的参数，而net和scsi则依赖于内核配置。例如，如果系统不支持scsi，则scsi 目录不存在。  
除了以上介绍的这些，还有的是一些以数字命名的目录，它们是进程目录。系统中当前运行的每一个进程都有对应的一个目录在/proc下，以进程的 PID号为目录名，它们是读取进程信息的接口。而self目录则是读取进程本身的信息接口，是一个link。  
```shell
/proc/buddyinfo 每个内存区中的每个order有多少块可用，和内存碎片问题有关
/proc/cmdline 启动时传递给kernel的参数信息
/proc/cpuinfo cpu的信息
/proc/crypto 内核使用的所有已安装的加密密码及细节
/proc/devices 已经加载的设备并分类
/proc/dma 已注册使用的ISA DMA频道列表
/proc/execdomains Linux内核当前支持的execution domains
/proc/fb 帧缓冲设备列表，包括数量和控制它的驱动
/proc/filesystems 内核当前支持的文件系统类型
/proc/interrupts x86架构中的每个IRQ中断数
/proc/iomem 每个物理设备当前在系统内存中的映射
/proc/ioports 一个设备的输入输出所使用的注册端口范围
/proc/kcore 代表系统的物理内存，存储为核心文件格式，里边显示的是字节数，等于RAM大小加上4kb
/proc/kmsg 记录内核生成的信息，可以通过/sbin/klogd或/bin/dmesg来处理
/proc/loadavg 根据过去一段时间内CPU和IO的状态得出的负载状态，与uptime命令有关
/proc/locks 内核锁住的文件列表
/proc/mdstat 多硬盘，RAID配置信息(md=multiple disks)
/proc/meminfo RAM使用的相关信息
/proc/misc 其他的主要设备(设备号为10)上注册的驱动
/proc/modules 所有加载到内核的模块列表
/proc/mounts 系统中使用的所有挂载
/proc/mtrr 系统使用的Memory Type Range Registers (MTRRs)
/proc/partitions 分区中的块分配信息
/proc/pci 系统中的PCI设备列表
/proc/slabinfo 系统中所有活动的 slab 缓存信息
/proc/stat 所有的CPU活动信息
/proc/sysrq-trigger 使用echo命令来写这个文件的时候，远程root用户可以执行大多数的系统请求关键命令，就好像在本地终端执行一样。要写入这个文件，需要把/proc/sys/kernel/sysrq不能设置为0。这个文件对root也是不可读的
/proc/uptime 系统已经运行了多久
/proc/swaps 交换空间的使用情况
/proc/version Linux内核版本和gcc版本
/proc/bus 系统总线(Bus)信息，例如pci/usb等
/proc/driver 驱动信息
/proc/fs 文件系统信息
/proc/ide ide设备信息
/proc/irq 中断请求设备信息
/proc/net 网卡设备信息
/proc/scsi scsi设备信息
/proc/tty tty设备信息
/proc/net/dev 显示网络适配器及统计信息
/proc/vmstat 虚拟内存统计信息
/proc/vmcore 内核panic时的内存映像
/proc/diskstats 取得磁盘信息
/proc/schedstat kernel调度器的统计信息
/proc/zoneinfo 显示内存空间的统计信息，对分析虚拟内存行为很有用
以下是/proc目录中进程N的信息
/proc/N pid为N的进程信息
/proc/N/cmdline 进程启动命令
/proc/N/cwd 链接到进程当前工作目录
/proc/N/environ 进程环境变量列表
/proc/N/exe 链接到进程的执行命令文件
/proc/N/fd 包含进程相关的所有的文件描述符
/proc/N/maps 与进程相关的内存映射信息
/proc/N/mem 指代进程持有的内存，不可读
/proc/N/root 链接到进程的根目录
/proc/N/stat 进程的状态
/proc/N/statm 进程使用的内存的状态
/proc/N/status 进程状态信息，比stat/statm更具可读性
/proc/self 链接到当前正在运行的进程
```

## <a id="3">linux系统net/port操作</a>
```shell
端口常用操作：
netstat -tlunp：查看当前主机在监听哪些端口，显示出当前主机打开的所有端口
netstat -lnpt：查看监听的端口  netstat -lnpt | grep 1220
nmap ip_address：ip_address就是你要扫描的主机IP地址
nc -lp 23 &:打开23端口，即telnet
iptables-save > /etc/sysconfig/iptables:打开端口后保存

常见端口对应应用：
23:telnet
1935:rtmp
```

## <a id="4">Yum简介</a>
Yum（全称为 Yellow dog Updater, Modified）是一个在Fedora和RedHat以及CentOS中的Shell前端软件包管理器。基于RPM包管理，能够从指定的服务器自动下载RPM包并且安装，可以自动处理依赖性关系，并且一次安装所有依赖的软件包，无须繁琐地一次次下载、安装。  
### yum命令
```shell
yum list installed   显示已经安装的软件包
yum list tomcat    找可以安装的软件包 （以 tomcat 为例）
yum install tomcat  安装软件包 （以 tomcat 为例）
yum remove tomcat   卸载软件包 （以 tomcat 为例）
yum deplist tomcat  列出软件包的依赖
yum -y install tomcat  -y 自动应答yes
yum info tomcat   显示软件包的描述信息和概要信息 （以 tomcat 为例）
yum update  升级所有的软件包
yum update tomcat  升级某一个软件包 ，以升级 tomcat 为例
yum check-update  检查可更新的程序
yum install yumex     Yum可视化图形界面Yumex
```

### yum下载文件的存放位置  
```shell
默认是： /var/cache/yum
也可以在 /etc/yum.conf 指定
cachedir=/var/cache/yum #存放目录
keepcache=1 ＃1为保存 0为不保存
metadata_expire=1800 ＃过期时间 
```

### CentOS下yum本地源创建
参考链接：  
https://www.cnblogs.com/liangqihui/p/7154407.html   
#### 方法1
1.创建yum配置文件  
cd /etc/yum.repos.d/  
发现里面有几个.repo文件，里面描述的就是用yum进行安装时所要连接的镜像url，我们自己需要创建一个.repo文件，在此命名为local.repo。  
```shell 
vi local.repo
[local_server]
name=This is local repo
baseurl=http://15.32.12.129/CentOS/
enabeld=1
gpgcheck=0
```
gpgcheck=0时表示不对GPG-KEY进行检查。  如果我们已经把所有所需要的.rpm文件全部拷贝到122这台电脑上，如目录为/rpm/下时，在baseurl这栏应该写为：  
baseurl=file:///rpm/           //这里斜杠有三个  

2、对yum进行初始化操作  
yum clean all  //清除缓存  
yum makecache   //建立新缓存  
但可能会发现建立新缓存失败，因为原来那几个.repo文件里的镜像是需要用外网连接的，但现在条件是没有外网，所以会提示找不到这些镜像url，我们可以将这些.repo文件的扩展名改了，如都改为.repo_bark等，或者将这些.repo文件移动到其他文件下：
```shell
#mkdir back
#mv Cent* back/
```
则yum.repos.d目录下只有一个local.repo文件，再重新以上操作就行。  

3、可以用yum进行安装文件  如yum -y install tar

#### 方法2
使用createrepo命令创建yum仓库
1.将所有rpm文件拷贝到一个文件夹中 cp -rv /media/光盘/Packs/*  /所建立的文件夹  
2.通过rpm命令手动安装createrepo命令创建yum仓库 rpm -ivh createrepo  
3.运行命令createrepo -v /rpm-directory  
4.如果有分组信息，则在运行命令的时候使用-g参数置顶分组文件  
```shell
makedir /localserver （建立本地文件夹）
mount /dev/cdrom  /media/cdrom
cp -rv /media/cdrom/光盘/Packs/*  /localserver
cd /localserver
rpm -ivh createrepo (若提示需要安装依赖包，根据提示安装即可）
createrepo -v /localserver/ (创建索引信息，repodate）
如若需要分组信息
cp /media/cdrom/光盘/repodate/*.comp /comps.xml
createrepo -g /comps.xml  /localserver (开始创建分组信息）
然后编辑repo文件（同方法一编辑方法相同）
```
5.yum clean all (清除缓存)  
yum makecache (建立新缓存)  

6 这下可以使用yum本地源了  
Test: yuminstall –y sendmail  

## links
  * [目录](<目录.md>)